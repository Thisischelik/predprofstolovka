<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ–Ω—é —É—á–µ–Ω–∏–∫–∞</title>
    <link href="–æ–±—â–∏–π.css" rel="stylesheet" type="text/css" />
</head>
<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="flash-item flash-{{ 'success' if category == 'success' else 'error' if category == 'error' else 'info' }}">
              {{ message }}
              <span style="cursor:pointer;margin-left:10px;" onclick="this.parentElement.remove()">√ó</span>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% if user %}
    <div class="user-panel">
        <div>
            <strong>ID:</strong> {{ user.id }} | 
            <strong>–õ–æ–≥–∏–Ω:</strong> {{ user.username }} |
            <strong>–§–ò–û:</strong> {{ user.fio }} | 
            <a href="{{ url_for('payment') }}" style="color: #38bdf8; text-decoration: underline; margin: 0; padding: 0; display: inline; background: none;">
                <strong>–ë–∞–ª–∞–Ω—Å:</strong> {{ user.balance or 0.0 }} —Ä—É–±.
            </a>
        </div>
        <div>
            <a href="{{ url_for('profile_settings') }}">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="{{ url_for('logout') }}" style="color: #e74c3c;">–í—ã—Ö–æ–¥</a>
        </div>
    </div>
    {% endif %}

    <div class="menu-container">
        <h1>–ú–µ–Ω—é —É—á–µ–Ω–∏–∫–∞</h1>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 30px;">
            <a href="{{ url_for('purchase_meals') }}" class="btn btn-primary" style="margin: 0; background: #6c5ce7;">üçΩ –ö—É–ø–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ</a>
            <a href="{{ url_for('payment') }}" class="btn btn-primary" style="margin: 0;">üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∫–∞—Ä—Ç—ã</a>
            <a href="{{ url_for('reviews') }}" class="btn btn-secondary" style="margin: 0;">üí¨ –û—Ç–∑—ã–≤—ã</a>
            <a href="{{ url_for('support') }}" class="btn btn-secondary" style="margin: 0;">üõ† –ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
        </div>

        <hr>
        <h2>–ú–æ–∏ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
        <table>
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td>{{ order.timestamp.strftime('%d.%m.%Y %H:%M') if order.timestamp else '---' }}</td>
                    <td>{{ order.meal_type }}</td>
                    <td>
                        <span class="{{ 'text-success' if order.is_issued else 'text-warning' }}">
                            {{ '–ü–æ–ª—É—á–µ–Ω–æ' if order.is_issued else '–û–ø–ª–∞—á–µ–Ω–æ' }}
                        </span>
                    </td>
                    <td>
                        {% if not order.is_issued %}
                            <a href="{{ url_for('claim_meal', order_id=order.id) }}" class="btn" style="width: auto; margin: 0; padding: 5px 10px; border-radius: 4px; text-decoration: none; font-size: 0.8em; background: #00b894; color: white; display: inline-block;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</a>
                        {% else %}
                            üëå
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
                {% if not orders %}
                <tr>
                    <td colspan="4">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</body>
</html>
