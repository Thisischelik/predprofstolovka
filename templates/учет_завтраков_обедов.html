<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ñ—É—Ä–Ω–∞–ª –∑–∞–∫–∞–∑–æ–≤</title>
    <link href="–æ–±—â–∏–π.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <div class="menu-container">
        <h1>–ñ—É—Ä–Ω–∞–ª –≤—ã–¥–∞—á–∏ –ø–∏—Ç–∞–Ω–∏—è</h1>
        <table>
            <thead>
                <tr>
                    <th>–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞</th>
                    <th>–£—á–µ–Ω–∏–∫ / –ö–ª–∞—Å—Å</th>
                    <th>–¢–∏–ø –ø–∏—Ç–∞–Ω–∏—è</th>
                    <th>–ê–ª–ª–µ—Ä–≥–∏–∏ / –ü–æ–∂–µ–ª–∞–Ω–∏—è</th>
                    <th>–°—Ç–∞—Ç—É—Å –≤—ã–¥–∞—á–∏</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                {% set student = students.get(order.user_id) %}
                <tr>
                    <td>{{ order.timestamp.strftime('%d.%m.%Y %H:%M') if order.timestamp else '---' }}</td>
                    <td><b>{{ student.username if student else order.user_name }}</b><br><small>ID: {{ order.user_id }} {{ '(' ~ student.classes ~ ')' if student else '' }}</small></td>
                    <td>{{ order.meal_type }}</td>
                    <td>
                        {% if student %}
                            {% if student.allergy %}
                                <div style="color: #d63031; font-weight: bold; font-size: 0.85em;">‚ö†Ô∏è {{ student.allergy }}</div>
                            {% endif %}
                            {% if student.preferences %}
                                <div style="color: #27ae60; font-style: italic; font-size: 0.85em;">üí¨ {{ student.preferences }}</div>
                            {% endif %}
                            {% if not student.allergy and not student.preferences %}
                                <span style="color: #999;">---</span>
                            {% endif %}
                        {% else %}
                            <span style="color: #999;">---</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="{{ 'text-success' if order.is_issued else 'text-danger' }}" style="font-weight: bold;">
                            {{ '–í—ã–¥–∞–Ω–æ' if order.is_issued else '–ù–µ –≤—ã–¥–∞–Ω–æ' }}
                        </span>
                    </td>
                    <td>
                        {% if not order.is_issued and session.get('role') == 'chef' %}
                        <form action="{{ url_for('issue_meal', order_id=order.id) }}" method="POST">
                            <button type="submit" class="btn" style="padding: 5px 10px; font-size: 0.8em; margin: 0;">–í—ã–¥–∞—Ç—å</button>
                        </form>
                        {% elif order.is_issued %}
                        üëå
                        {% else %}
                        -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
                {% if not orders %}
                <tr>
                    <td colspan="6" style="text-align: center;">–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
        
        <div style="margin-top: 30px;">
            {% if session.get('role') == 'admin' %}
                <a href="{{ url_for('admin_menu') }}" class="back-link">‚Üê –í –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a>
            {% else %}
                <a href="{{ url_for('chef_menu') }}" class="back-link">‚Üê –í –º–µ–Ω—é –ø–æ–≤–∞—Ä–∞</a>
            {% endif %}
        </div>
    </div>
</body>
</html>
